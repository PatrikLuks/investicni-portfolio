<!doctype html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Profesion√°ln√≠ spr√°va investiƒçn√≠ch portfoli√≠ s pokroƒçil√Ωmi analytick√Ωmi n√°stroji"
    />
    <meta name="theme-color" content="#1a237e" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Portfolio Manager" />

    <!-- üöÄ PERFORMANCE: Resource Hints -->
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" />
    <link rel="dns-prefetch" href="https://cdn.sheetjs.com" />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />

    <!-- Security Headers -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.sheetjs.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self';"
    />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <!-- X-Frame-Options removed - only works in HTTP headers, not meta tags -->
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />

    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144x144.png" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-96x96.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-72x72.png" />

    <title>Spr√°va Investiƒçn√≠ho Portfolia</title>

    <!-- ‚ö° PERFORMANCE FIX: External libraries REMOVED -->
    <!-- These 5 libraries were causing CPU overload (~2MB JS): -->
    <!-- - Fuse.js, Chart.js, Chart.js Zoom, jsPDF, SheetJS -->
    <!-- Will load on-demand when needed via library-loader.js -->

    <link rel="stylesheet" href="accessibility.css" />
    <link rel="stylesheet" href="module-loader.css" />
    <link rel="stylesheet" href="search-styles.css" />
    <link rel="stylesheet" href="drag-drop.css" />
    <link rel="stylesheet" href="cloud-backup.css" />
    <link rel="stylesheet" href="validation-styles.css" />
    <link rel="stylesheet" href="charts-styles.css" />
    <link rel="stylesheet" href="quick-reference.css" />
    <link rel="stylesheet" href="calculations-styles.css" />
    <link rel="stylesheet" href="dashboard-styles.css" />
    <style>
      :root {
        --primary-blue: #1a237e;
        --secondary-blue: #3949ab;
        --background: #ffffff;
        --text-primary: #2c3e50;
        --text-secondary: #7f8c8d;
        --border-color: #e0e0e0;
        --card-background: #ffffff;
        --input-background: #ffffff;
        --shadow: rgba(0, 0, 0, 0.1);
        /* Color schemes */
        --scheme-blue-primary: #1a237e;
        --scheme-blue-secondary: #3949ab;

        --scheme-red-primary: #c0392b;
        --scheme-red-secondary: #e74c3c;

        --scheme-green-primary: #27ae60;
        --scheme-green-secondary: #2ecc71;

        --scheme-yellow-primary: #f39c12;
        --scheme-yellow-secondary: #f1c40f;
      }

      body.dark-mode {
        --background: #1a1a1a;
        --text-primary: #e0e0e0;
        --text-secondary: #a0a0a0;
        --border-color: #333333;
        --card-background: #2d2d2d;
        --input-background: #3a3a3a;
        --shadow: rgba(0, 0, 0, 0.3);
      }

      body {
        font-family: 'Inter', 'Segoe UI', sans-serif;
        margin: 0;
        padding: 40px;
        background-color: var(--background);
        min-height: 100vh;
        color: var(--text-primary);
        line-height: 1.5;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
      }

      .card {
        background-color: var(--background);
        border-radius: 12px;
        padding: 32px;
        margin-bottom: 24px;
        border: 1px solid var(--border-color);
        width: 100%;
        box-sizing: border-box;
      }

      .form-group {
        margin-bottom: 24px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text-primary);
        font-size: 0.875rem;
      }

      input {
        width: 100%;
        padding: 12px;
        background: var(--background);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 0.875rem;
        color: var(--text-primary);
      }

      input:focus {
        border-color: var(--primary-blue);
        outline: none;
        box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
      }

      .button-group {
        display: flex;
        gap: 12px;
      }

      button {
        background: var(--primary-blue);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
      }

      button.secondary {
        background: white;
        color: var(--primary-blue);
        border: 1px solid var(--primary-blue);
      }

      .fond-table {
        width: 100%;
        border-collapse: collapse;
        margin: 16px auto;
        font-size: 0.875rem;
        table-layout: fixed;
      }

      .fond-table th,
      .fond-table td {
        padding: 12px 16px;
        border-bottom: 1px solid var(--border-color);
        width: 20%;
      }

      .fond-table th {
        padding: 12px 16px;
        text-align: left;
        background: #f8f9fa;
        color: var(--text-primary);
        font-weight: 500;
        border-bottom: 1px solid var(--border-color);
      }

      .inline-edit {
        background: transparent;
        border: 1px solid transparent;
        width: 100%;
        padding: 4px;
        font-size: inherit;
        font-family: inherit;
        color: var(--text-primary);
      }

      .inline-edit:focus {
        border-color: var(--primary-blue);
        border-radius: 4px;
        outline: none;
      }

      .delete-btn {
        color: #dc3545;
        background: transparent;
        border: 1px solid #dc3545;
        padding: 6px 12px;
        font-size: 0.75rem;
      }

      h1,
      h2 {
        color: var(--text-primary);
        margin-bottom: 24px;
        font-weight: 600;
        font-size: 1.5rem;
      }

      #clientNameDisplay {
        color: var(--primary-blue);
        font-weight: 500;
      }

      /* Odstranƒõno monospace font pro jednotn√Ω vzhled */

      @media (max-width: 768px) {
        body {
          padding: 20px;
        }

        .card {
          padding: 20px;
        }
      }

      .report-info {
        position: absolute;
        top: 20px;
        right: 20px;
        text-align: right;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      .report-info p {
        margin: 5px 0;
      }

      .header {
        position: relative;
        margin-bottom: 30px;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 40px;
        padding: 20px;
      }

      .logo-section {
        flex-shrink: 0;
        width: 50%;
      }

      .logo {
        height: 100px;
        display: block;
      }

      .report-info {
        width: 50%;
        text-align: right;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      .report-info p {
        margin: 5px 0;
      }

      h1 {
        color: var(--text-primary);
        margin: 40px 0 24px;
        font-size: 2.5rem;
        font-weight: 600;
        text-align: center;
        clear: both;
      }

      .disclaimer {
        margin-top: 40px;
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 8px;
        font-size: 0.875rem;
        color: var(--text-secondary);
        line-height: 1.6;
      }

      .disclaimer p {
        margin-bottom: 16px;
      }

      .disclaimer p:last-child {
        margin-bottom: 0;
      }

      .color-picker {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .scheme-button {
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        border: none;
        color: white;
        font-weight: 500;
      }

      .blue-scheme {
        background-color: #1a237e;
      }
      .red-scheme {
        background-color: #c0392b;
      }
      .green-scheme {
        background-color: #27ae60;
      }
      .yellow-scheme {
        background-color: #f39c12;
      }

      .scheme-button.active {
        outline: 3px solid #333;
      }

      .currency-switch {
        margin-bottom: 20px;
        padding: 12px;
        background-color: #f8f9fa;
        border-radius: 6px;
        border: 1px solid var(--border-color);
      }

      .checkbox-label {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-weight: 500;
        color: var(--text-primary);
        margin: 0;
      }

      .checkbox-label input[type='checkbox'] {
        width: auto;
        margin-right: 8px;
        cursor: pointer;
      }

      .checkmark {
        margin-left: 8px;
      }

      .form-select {
        width: 100%;
        padding: 12px;
        background: var(--background);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 0.875rem;
        color: var(--text-primary);
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 1rem center;
        background-size: 1em;
      }

      .form-select:focus {
        border-color: var(--primary-blue);
        outline: none;
        box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
      }

      /* Enhanced Table Styles */
      .table-controls {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .search-box {
        position: relative;
        flex: 1;
        min-width: 250px;
      }

      .search-box input {
        width: 100%;
        padding: 10px 40px 10px 40px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 0.875rem;
        transition: all 0.3s ease;
      }

      .search-box input:focus {
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
      }

      .search-box::before {
        content: 'üîç';
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 16px;
      }

      .search-box .clear-search {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: var(--text-secondary);
        font-size: 18px;
        padding: 0;
        width: 24px;
        height: 24px;
        display: none;
      }

      .search-box .clear-search:hover {
        color: var(--text-primary);
        transform: translateY(-50%) scale(1.2);
        box-shadow: none;
      }

      .fond-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin: 16px auto;
        font-size: 0.875rem;
        table-layout: fixed;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .fond-table thead {
        position: sticky;
        top: 0;
        z-index: 10;
        background: linear-gradient(180deg, #0d1b2a 0%, #1b263b 100%);
      }

      .fond-table th {
        background: transparent;
        color: white;
        padding: 14px 16px;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid #c8940a;
        cursor: pointer;
        user-select: none;
        position: relative;
        transition: background 0.2s ease;
      }

      .fond-table th:hover {
        background: rgba(200, 148, 10, 0.1);
      }

      .fond-table th.sortable::after {
        content: '‚áÖ';
        position: absolute;
        right: 8px;
        opacity: 0.5;
        font-size: 14px;
      }

      .fond-table th.sort-asc::after {
        content: '‚Üë';
        opacity: 1;
        color: #c8940a;
      }

      .fond-table th.sort-desc::after {
        content: '‚Üì';
        opacity: 1;
        color: #c8940a;
      }

      .fond-table tbody tr {
        background: white;
        transition: all 0.2s ease;
      }

      .fond-table tbody tr:nth-child(even) {
        background: #f8f9fa;
      }

      .fond-table tbody tr:hover {
        background: linear-gradient(
          90deg,
          rgba(200, 148, 10, 0.08) 0%,
          rgba(200, 148, 10, 0.02) 100%
        );
        transform: translateX(2px);
        box-shadow: -4px 0 0 0 #c8940a inset;
      }

      .fond-table td {
        padding: 12px 16px;
        border-bottom: 1px solid #e0e0e0;
      }

      .fond-table tbody tr:last-child td {
        border-bottom: none;
      }

      /* Number cells - tabular nums */
      .fond-table td:nth-child(4),
      .fond-table td:nth-child(5) {
        font-feature-settings: 'tnum';
        font-variant-numeric: tabular-nums;
      }

      @media print {
        .card {
          border: none;
          padding: 0; /* Odstran√≠me i padding pro lep≈°√≠ vyu≈æit√≠ prostoru */
          margin-bottom: 20px; /* Ponech√°me men≈°√≠ mezeru mezi sekcemi */
        }
      }

      .charts-container canvas {
        width: 700px !important;
        height: 700px !important;
        max-width: 100%;
        max-height: 100%;
        display: block;
        margin: 0 auto;
        background: transparent;
        border-radius: 16px;
        filter: drop-shadow(0 8px 24px rgba(200, 148, 10, 0.12));
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .charts-container canvas:hover {
        filter: drop-shadow(0 12px 32px rgba(200, 148, 10, 0.18));
        transform: translateY(-2px);
      }

      .charts-container .card {
        background: linear-gradient(135deg, #ffffff 0%, #fafafa 100%);
        border: 1px solid rgba(200, 148, 10, 0.1);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .charts-container .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, #c8940a 0%, #ffd700 50%, #c8940a 100%);
        opacity: 0;
        transition: opacity 0.4s ease;
      }

      .charts-container .card:hover::before {
        opacity: 1;
      }

      .charts-container .card:hover {
        border-color: rgba(200, 148, 10, 0.3);
        box-shadow: 0 20px 40px rgba(200, 148, 10, 0.15);
        transform: translateY(-4px);
      }

      /* Dashboard KPI Cards */
      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 32px;
        opacity: 0;
        animation: fadeInUp 0.6s ease-out forwards;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes chartZoomIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes shimmer {
        0% {
          background-position: -1000px 0;
        }
        100% {
          background-position: 1000px 0;
        }
      }

      @keyframes glow {
        0%,
        100% {
          filter: drop-shadow(0 8px 24px rgba(200, 148, 10, 0.12));
        }
        50% {
          filter: drop-shadow(0 12px 32px rgba(200, 148, 10, 0.24));
        }
      }

      .charts-container .card {
        animation: chartZoomIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      }

      .charts-container .card:nth-child(1) {
        animation-delay: 0.2s;
        opacity: 0;
      }

      .charts-container .card:nth-child(2) {
        animation-delay: 0.4s;
        opacity: 0;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.8;
          transform: scale(1.02);
        }
      }

      @keyframes countUp {
        from {
          opacity: 0;
          transform: scale(0.8);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      @keyframes slideInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .kpi-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 16px;
        padding: 24px;
        border: 1px solid #e0e0e0;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .kpi-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #c8940a 0%, #8b6508 100%);
      }

      .kpi-card.positive::before {
        background: linear-gradient(90deg, #10b981 0%, #059669 100%);
      }

      .kpi-card.negative::before {
        background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
      }

      .kpi-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
        border-color: #c8940a;
      }

      .kpi-card .icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin-bottom: 16px;
        background: linear-gradient(135deg, #c8940a 0%, #8b6508 100%);
        box-shadow: 0 4px 8px rgba(200, 148, 10, 0.3);
      }

      .kpi-card.positive .icon {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
      }

      .kpi-card.negative .icon {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
      }

      .kpi-card .label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 8px;
      }

      .kpi-card .value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        font-feature-settings: 'tnum';
        font-variant-numeric: tabular-nums;
        margin-bottom: 8px;
        animation: countUp 0.8s ease-out;
      }

      .kpi-card .change {
        font-size: 0.875rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .kpi-card .change.positive {
        color: #10b981;
      }

      .kpi-card .change.negative {
        color: #ef4444;
      }

      .kpi-card .subtext {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-top: 8px;
      }

      /* Smooth transitions everywhere */
      * {
        transition:
          border-color 0.3s ease,
          box-shadow 0.3s ease;
      }

      button,
      .card,
      .kpi-card,
      input,
      select {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Enhanced hover effects */
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(26, 35, 126, 0.2);
      }

      button:active {
        transform: translateY(0);
        box-shadow: 0 4px 8px rgba(26, 35, 126, 0.2);
      }

      .card {
        animation: fadeInUp 0.6s ease-out;
      }

      /* Toast Notifications */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 12px;
        pointer-events: none;
      }

      .toast {
        background: white;
        border-radius: 8px;
        padding: 16px 20px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 300px;
        max-width: 400px;
        pointer-events: auto;
        animation: slideInRight 0.3s ease-out;
        border-left: 4px solid;
      }

      .toast.success {
        border-left-color: #10b981;
      }

      .toast.error {
        border-left-color: #ef4444;
      }

      .toast.warning {
        border-left-color: #f59e0b;
      }

      .toast.info {
        border-left-color: #3b82f6;
      }

      .toast.removing {
        animation: slideOutRight 0.3s ease-out forwards;
      }

      @keyframes slideInRight {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(400px);
          opacity: 0;
        }
      }

      .toast-icon {
        font-size: 20px;
        flex-shrink: 0;
      }

      .toast-content {
        flex: 1;
      }

      .toast-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 2px;
      }

      .toast-message {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .toast-close {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: var(--text-secondary);
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        flex-shrink: 0;
      }

      .toast-close:hover {
        background: #f3f4f6;
        color: var(--text-primary);
        transform: none;
        box-shadow: none;
      }

      /* ==================== EMPTY STATES ==================== */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-secondary);
      }

      .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .empty-state-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .empty-state-description {
        font-size: 0.875rem;
        margin-bottom: 1.5rem;
      }

      /* ==================== LOADING STATES ==================== */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.2s;
      }

      .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top-color: #c8940a;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loading-inline {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(26, 35, 126, 0.3);
        border-top-color: var(--primary-blue);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-left: 8px;
        vertical-align: middle;
      }

      /* ==================== TOOLTIPS ==================== */
      .tooltip {
        position: relative;
        display: inline-block;
      }

      .tooltip-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        background: var(--text-secondary);
        color: white;
        border-radius: 50%;
        font-size: 0.75rem;
        font-weight: bold;
        cursor: help;
        margin-left: 6px;
        transition: all 0.2s;
      }

      .tooltip-icon:hover {
        background: var(--primary-blue);
        transform: scale(1.1);
      }

      .tooltip-content {
        visibility: hidden;
        opacity: 0;
        position: absolute;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        background: #2d2d2d;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.75rem;
        white-space: nowrap;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        transition: all 0.2s;
        pointer-events: none;
      }

      .tooltip-content::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border: 5px solid transparent;
        border-top-color: #2d2d2d;
      }

      .tooltip:hover .tooltip-content {
        visibility: visible;
        opacity: 1;
      }

      /* ==================== BULK ACTIONS ==================== */
      .bulk-actions-bar {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        margin-bottom: 16px;
        display: none;
        align-items: center;
        justify-content: space-between;
        animation: slideInDown 0.3s;
      }

      .bulk-actions-bar.active {
        display: flex;
      }

      .bulk-actions-info {
        font-size: 0.875rem;
        font-weight: 500;
      }

      .bulk-actions-buttons {
        display: flex;
        gap: 8px;
      }

      .bulk-action-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 6px 14px;
        border-radius: 4px;
        font-size: 0.813rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .bulk-action-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .bulk-action-btn.danger {
        background: rgba(239, 68, 68, 0.9);
        border-color: rgba(239, 68, 68, 1);
      }

      .bulk-action-btn.danger:hover {
        background: rgba(220, 38, 38, 1);
      }

      .row-checkbox {
        width: 18px;
        height: 18px;
        cursor: pointer;
        accent-color: var(--primary-blue);
      }

      /* ==================== PRINT STYLES ==================== */
      @media print {
        body {
          background: white;
          padding: 0;
        }

        .toast-container,
        #darkModeToggle,
        button,
        .bulk-actions-bar,
        .table-controls,
        .button-group {
          display: none !important;
        }

        .card {
          box-shadow: none;
          border: 1px solid #ddd;
          page-break-inside: avoid;
        }

        .dashboard {
          display: grid !important;
        }

        table {
          border-collapse: collapse;
        }

        th,
        td {
          border: 1px solid #ddd;
          padding: 8px;
        }
      }

      /* ==================== RESPONSIVE DESIGN ==================== */
      @media (max-width: 768px) {
        body {
          padding: 16px;
        }

        .container {
          max-width: 100%;
        }

        .card {
          padding: 20px;
        }

        .dashboard {
          grid-template-columns: 1fr !important;
          gap: 12px;
        }

        .kpi-card {
          padding: 16px;
        }

        .button-group {
          flex-direction: column;
          gap: 8px;
        }

        .button-group button {
          width: 100%;
        }

        table {
          font-size: 0.875rem;
        }

        th,
        td {
          padding: 8px 4px;
        }

        .toast-container {
          top: 10px;
          right: 10px;
          left: 10px;
          width: auto;
        }

        #darkModeToggle {
          top: 10px;
          right: 10px;
          padding: 8px 12px;
        }

        .color-picker {
          flex-wrap: wrap;
          gap: 8px;
        }

        .scheme-button {
          flex: 1 1 calc(50% - 8px);
          min-width: 120px;
        }
      }

      @media (max-width: 480px) {
        .table-controls {
          flex-direction: column;
          align-items: stretch;
        }

        .view-switch {
          flex-direction: column;
        }

        .switch-btn {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Dark Mode Toggle -->
    <button
      id="darkModeToggle"
      style="
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 10px 16px;
        border: 1px solid var(--border-color);
        background: var(--card-background);
        color: var(--text-primary);
        border-radius: 8px;
        cursor: pointer;
        z-index: 1000;
        font-size: 1.2rem;
        transition: all 0.3s;
      "
    >
      üåô
    </button>

    <div class="container">
      <!-- Dashboard KPI Cards -->
      <div class="dashboard" id="dashboard" style="display: none">
        <div class="kpi-card" id="kpiTotalInvestment">
          <div class="icon">üí∞</div>
          <div class="label">Celkov√° investice</div>
          <div class="value" id="kpiValueInvestment">0 Kƒç</div>
          <div class="subtext">ƒåist√° investovan√° ƒç√°stka</div>
        </div>
        <div class="kpi-card" id="kpiCurrentValue">
          <div class="icon">üìä</div>
          <div class="label">Aktu√°ln√≠ hodnota</div>
          <div class="value" id="kpiValueCurrent">0 Kƒç</div>
          <div class="subtext">Celkov√° hodnota portfolia</div>
        </div>
        <div class="kpi-card positive" id="kpiTotalYield">
          <div class="icon">üìà</div>
          <div class="label">Celkov√Ω v√Ωnos</div>
          <div class="value" id="kpiValueYield">+0.00%</div>
          <div class="change positive" id="kpiChangeYield">
            <span>‚Üë</span>
            <span id="kpiProfitAmount">+0 Kƒç</span>
          </div>
        </div>
        <div class="kpi-card" id="kpiBestFund">
          <div class="icon">üèÜ</div>
          <div class="label">Nejlep≈°√≠ fond</div>
          <div class="value" id="kpiValueBestFund" style="font-size: 1.2rem; line-height: 1.3">
            -
          </div>
          <div class="subtext" id="kpiBestFundYield">Nejvy≈°≈°√≠ v√Ωnos: 0%</div>
        </div>
      </div>

      <div class="card" id="clientNameCard">
        <h1>Zadejte √∫daje</h1>
        <form id="clientForm">
          <div class="form-group">
            <label for="clientName">Jm√©no klienta:</label>
            <input type="text" id="clientName" required />
          </div>
          <div class="form-group">
            <label for="advisorName">Jm√©no a p≈ô√≠jmen√≠ poradce:</label>
            <input type="text" id="advisorName" required />
          </div>
          <div class="form-group">
            <label for="advisorEmail">Email poradce:</label>
            <input type="email" id="advisorEmail" required />
          </div>
          <button type="submit">Potvrdit</button>
        </form>
      </div>

      <div class="card" id="portfolioCard" style="display: none">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
          "
        >
          <h1 style="margin: 0">Portfolio klienta: <span id="clientNameDisplay"></span></h1>
          <div style="display: flex; align-items: center; gap: 1rem">
            <button
              id="openSearchPanel"
              class="btn-icon"
              title="Pokroƒçil√© vyhled√°v√°n√≠ (Ctrl+F)"
              aria-label="Otev≈ô√≠t pokroƒçil√© vyhled√°v√°n√≠"
              style="
                font-size: 1.5rem;
                padding: 8px 16px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.2s ease;
              "
            >
              üîç Hledat
            </button>
            <div
              id="lastSaveIndicator"
              style="font-size: 0.875rem; color: #666; opacity: 0; transition: opacity 0.3s"
            >
              <span style="margin-right: 0.5rem">üíæ</span>
              <span id="lastSaveTime">Neulo≈æeno</span>
            </div>
          </div>
        </div>
        <div class="color-picker">
          <button type="button" class="scheme-button blue-scheme">Modr√°</button>
          <button type="button" class="scheme-button red-scheme">ƒåerven√°</button>
          <button type="button" class="scheme-button green-scheme">Zelen√°</button>
          <button type="button" class="scheme-button yellow-scheme">≈Ωlut√°</button>
        </div>
        <div class="currency-switch">
          <label class="checkbox-label">
            <input type="checkbox" id="currencySwitch" />
            <span class="checkmark"></span>
            Zobrazit v eurech (‚Ç¨)
          </label>
        </div>
        <form id="portfolioForm">
          <div class="form-group">
            <label for="fondName">
              N√°zev fondu:
              <span class="tooltip">
                <span class="tooltip-icon">?</span>
                <span class="tooltip-content">Vyberte nebo napi≈°te n√°zev investiƒçn√≠ho fondu</span>
              </span>
            </label>
            <input type="text" id="fondName" list="fondList" required />
            <datalist id="fondList">
              <option
                value="1. fond reverzn√≠ch hypot√©k SICAV, a.s. Pr√©miov√© investiƒçn√≠ akcie"
              ></option>
              <option
                value="1. fond reverzn√≠ch hypot√©k SICAV, a.s. Prioritn√≠ investiƒçn√≠ akcie"
              ></option>
              <option
                value="4 Gimel Investments SICAV, a.s., Podfond Alfa 4 Gimel Investments"
              ></option>
              <option value="Active Invest Dynamick√Ω OPF, CFIS"></option>
              <option value="Active Invest Konzervativn√≠ OPF, CFIS"></option>
              <option value="Active Invest Vyv√°≈æen√Ω OPF, CFIS"></option>
              <option value="BlackRock-BGF World Healthscience A2 USD"></option>
              <option value="Conseq Invest Akcie Nov√© Evropy - T≈ô√≠da A"></option>
              <option value="Conseq Invest Akcie Nov√© Evropy - T≈ô√≠da B"></option>
              <option value="Conseq Invest Akcie Nov√© Evropy - T≈ô√≠da D"></option>
              <option value="Conseq Invest Dluhopisov√Ω - T≈ô√≠da A"></option>
              <option value="Conseq Invest Dluhopisov√Ω - T≈ô√≠da B"></option>
              <option value="Conseq Invest Dluhopisov√Ω - T≈ô√≠da D"></option>
              <option value="Conseq Invest Dluhopisy Nov√© Evropy - A"></option>
              <option value="Conseq Invest Dluhopisy Nov√© Evropy - D"></option>
              <option value="Conseq Invest Konzervativn√≠ - T≈ô√≠da A"></option>
              <option value="Conseq Invest Konzervativn√≠ - T≈ô√≠da D"></option>
              <option value="Conseq korpor√°tn√≠ch dluhopis≈Ø, OPF CFIS, a.s. A"></option>
              <option value="Conseq model portfolio aggressive ESG A (CZK)"></option>
              <option value="Conseq nemovitostn√≠ch fond≈Ø, OPF CFIS, a.s."></option>
              <option value="Conseq Opportunity OPFKI, QI IS"></option>
              <option value="Conseq realitn√≠, OPF CFIS, a.s."></option>
              <option value="Conseq Repofond"></option>
              <option value="ƒåeskomoravsk√Ω fond SICAV, a.s. Podfond AGUILA"></option>
              <option
                value="ƒåeskoslovensk√Ω nemovitostn√≠ fond SICAV, a.s. Pr√©miov√© investiƒçn√≠ akcie"
              ></option>
              <option
                value="ƒåeskoslovensk√Ω nemovitostn√≠ fond SICAV, a.s. Prioritn√≠ investiƒçn√≠ akcie"
              ></option>
              <option
                value="ƒåesk√Ω Fond P≈Ødy (CZK), Akumulaƒçn√≠ t≈ô√≠da, Na IU nelze po≈ô√≠dit p≈ôes ePort√°l"
              ></option>
              <option
                value="ƒåesk√Ω Fond P≈Ødy (CZK), Dividendov√° t≈ô√≠da, Na IU nelze po≈ô√≠dit p≈ôes ePort√°l"
              ></option>
            </datalist>
          </div>
          <div class="form-group">
            <label for="producer">
              Producent:
              <span class="tooltip">
                <span class="tooltip-icon">?</span>
                <span class="tooltip-content">Spr√°vce fondu (Avant, Conseq, J&T, Codya...)</span>
              </span>
            </label>
            <select id="producer" required class="form-select">
              <option value="">Vyberte producenta</option>
              <option value="Avant">Avant</option>
              <option value="Conseq">Conseq</option>
              <option value="J&T">J&T</option>
              <option value="Codya">Codya</option>
            </select>
          </div>
          <div class="form-group">
            <label for="investment">
              ƒåist√° investice (Kƒç):
              <span class="tooltip">
                <span class="tooltip-icon">?</span>
                <span class="tooltip-content">ƒå√°stka, kterou jste investovali do tohoto fondu</span>
              </span>
            </label>
            <input type="number" id="investment" required />
          </div>
          <div class="form-group">
            <label for="investmentDate">Datum investice:</label>
            <input type="date" id="investmentDate" required />
          </div>
          <div class="form-group">
            <label for="value">
              Aktu√°ln√≠ hodnota (Kƒç):
              <span class="tooltip">
                <span class="tooltip-icon">?</span>
                <span class="tooltip-content">Souƒçasn√° hodnota va≈°eho pod√≠lu v fondu</span>
              </span>
            </label>
            <input type="number" id="value" required />
          </div>
          <div class="button-group">
            <button type="submit">P≈ôidat fond</button>
            <button type="button" id="generateReport" class="secondary">Generovat report</button>
            <button
              type="button"
              id="exportExcel"
              class="secondary"
              style="background: #10b981; color: white"
            >
              üìä Export do Excelu
            </button>
          </div>
        </form>
      </div>
      <div class="card" id="fondListCard" style="display: none">
        <div class="view-switch" style="display: flex; gap: 10px; margin-bottom: 16px">
          <button id="switchFunds" class="switch-btn active" type="button">Fondy</button>
          <button id="switchProducers" class="switch-btn" type="button">Producenti</button>
        </div>
        <h2>P≈ôidan√© fondy</h2>

        <!-- Bulk Actions Bar -->
        <div class="bulk-actions-bar" id="bulkActionsBar">
          <div class="bulk-actions-info"><span id="selectedCount">0</span> vybran√Ωch fond≈Ø</div>
          <div class="bulk-actions-buttons">
            <button class="bulk-action-btn" id="bulkExport">üì• Export vybran√Ωch</button>
            <button class="bulk-action-btn danger" id="bulkDelete">üóëÔ∏è Smazat vybran√©</button>
            <button class="bulk-action-btn" id="bulkDeselect">‚úï Zru≈°it v√Ωbƒõr</button>
          </div>
        </div>

        <!-- Table Controls -->
        <div class="table-controls">
          <div class="search-box">
            <input
              type="text"
              id="tableSearch"
              placeholder="Hledat podle n√°zvu nebo producenta..."
            />
            <button class="clear-search" id="clearSearch">√ó</button>
          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none">
          <div class="empty-state-icon">üìä</div>
          <div class="empty-state-title">Zat√≠m ≈æ√°dn√© fondy</div>
          <div class="empty-state-description">
            Zaƒçnƒõte p≈ôid√°n√≠m prvn√≠ho fondu do portfolia pomoc√≠ formul√°≈ôe v√Ω≈°e.
          </div>
        </div>

        <table class="fond-table" id="fondTable">
          <thead id="fondTableHead">
            <tr>
              <th class="sortable" data-column="name">N√°zev fondu</th>
              <th class="sortable" data-column="producer">Producent</th>
              <th class="sortable" data-column="investmentDate">Datum investice</th>
              <th class="sortable" data-column="investment">ƒåist√° investice</th>
              <th class="sortable" data-column="value">Aktu√°ln√≠ hodnota</th>
              <th>Akce</th>
            </tr>
          </thead>
          <tbody id="fondTableBody"></tbody>
        </table>
      </div>
    </div>

    <script>
      const portfolioData = [];
      let clientName = '';

      // P≈ôid√°me seznam fond≈Ø
      const defaultFunds = [
        '1. fond reverzn√≠ch hypot√©k SICAV, a.s. Pr√©miov√© investiƒçn√≠ akcie',
        '1. fond reverzn√≠ch hypot√©k SICAV, a.s. Prioritn√≠ investiƒçn√≠ akcie',
        '4 Gimel Investments SICAV, a.s., Podfond Alfa 4 Gimel Investments',
        'Active Invest Dynamick√Ω OPF, CFIS',
        'Active Invest Konzervativn√≠ OPF, CFIS',
        'Active Invest Vyv√°≈æen√Ω OPF, CFIS',
        'BlackRock-BGF World Healthscience A2 USD',
        'Conseq Invest Akcie Nov√© Evropy - T≈ô√≠da A',
        'Conseq Invest Akcie Nov√© Evropy - T≈ô√≠da B',
        'Conseq Invest Akcie Nov√© Evropy - T≈ô√≠da D',
        'Conseq Invest Dluhopisov√Ω - T≈ô√≠da A',
        'Conseq Invest Dluhopisov√Ω - T≈ô√≠da B',
        'Conseq Invest Dluhopisov√Ω - T≈ô√≠da D',
        'Conseq Invest Dluhopisy Nov√© Evropy - A',
        'Conseq Invest Dluhopisy Nov√© Evropy - D',
        'Conseq Invest Konzervativn√≠ - T≈ô√≠da A',
        'Conseq Invest Konzervativn√≠ - T≈ô√≠da D',
        'Conseq korpor√°tn√≠ch dluhopis≈Ø, OPF CFIS, a.s. A',
        'Conseq model portfolio aggressive ESG A (CZK)',
        'Conseq nemovitostn√≠ch fond≈Ø, OPF CFIS, a.s.',
        'Conseq Opportunity OPFKI, QI IS',
        'Conseq realitn√≠, OPF CFIS, a.s.',
        'Conseq Repofond',
        'ƒåeskomoravsk√Ω fond SICAV, a.s. Podfond AGUILA',
        'ƒåeskoslovensk√Ω nemovitostn√≠ fond SICAV, a.s. Pr√©miov√© investiƒçn√≠ akcie',
        'ƒåeskoslovensk√Ω nemovitostn√≠ fond SICAV, a.s. Prioritn√≠ investiƒçn√≠ akcie',
        'ƒåesk√Ω Fond P≈Ødy (CZK), Akumulaƒçn√≠ t≈ô√≠da, Na IU nelze po≈ô√≠dit p≈ôes ePort√°l',
        'ƒåesk√Ω Fond P≈Ødy (CZK), Dividendov√° t≈ô√≠da, Na IU nelze po≈ô√≠dit p≈ôes ePort√°l',
      ];

      // P≈ôi prvn√≠m naƒçten√≠ str√°nky ulo≈æ√≠me fondy do localStorage
      if (!localStorage.getItem('funds')) {
        localStorage.setItem('funds', JSON.stringify(defaultFunds));
      }

      // Funkce pro p≈ôid√°n√≠ nov√©ho fondu do localStorage
      function addNewFund(fundName) {
        const funds = JSON.parse(localStorage.getItem('funds'));
        if (!funds.includes(fundName)) {
          funds.push(fundName);
          localStorage.setItem('funds', JSON.stringify(funds));
        }
      }

      // ==================== PWA SERVICE WORKER REGISTRATION (V3 Ultra-Optimized) ====================
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          // Register V3 service worker with aggressive caching
          navigator.serviceWorker
            .register('./service-worker-v3.js')
            .then((registration) => {
              console.log('‚úÖ SW V3: Registered (ultra-optimized):', registration.scope);

              // Check for updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                console.log('üîÑ SW V3: Update found, installing...');

                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // New update available
                    console.log('‚úÖ SW V3: Update ready');

                    if (window.notificationSystem) {
                      window.notificationSystem.showNotification(
                        'Nov√° verze dostupn√°! Kliknƒõte pro aktualizaci.',
                        'info',
                        () => {
                          newWorker.postMessage({ action: 'SKIP_WAITING' });
                          window.location.reload();
                        }
                      );
                    }
                  }
                });
              });
            })
            .catch((error) => {
              console.error('‚ùå SW V3: Registration failed:', error);
            });
        });

        // Listen for controller change (new SW activated)
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          console.log('üîÑ SW V3: Controller changed, reloading...');
          window.location.reload();
        });

        // Listen for messages from Service Worker
        navigator.serviceWorker.addEventListener('message', (event) => {
          console.log('üì® SW V3: Message:', event.data);
        });
      }

      // ==================== PWA INSTALL PROMPT ====================
      let deferredPrompt;

      window.addEventListener('beforeinstallprompt', (e) => {
        console.log('üíæ PWA Install prompt available');
        e.preventDefault();
        deferredPrompt = e;

        // Show custom install button (optional)
        showInstallPromotion();
      });

      function showInstallPromotion() {
        // Create install button if it doesn't exist
        if (!document.getElementById('installButton')) {
          const installBtn = document.createElement('button');
          installBtn.id = 'installButton';
          installBtn.innerHTML = 'üì± Instalovat aplikaci';
          installBtn.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    left: 20px;
                    padding: 12px 24px;
                    background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: 0.875rem;
                    font-weight: 600;
                    box-shadow: 0 4px 12px rgba(26, 35, 126, 0.3);
                    z-index: 10000;
                    transition: all 0.3s ease;
                `;

          installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;
              console.log(`User response: ${outcome}`);

              if (outcome === 'accepted') {
                console.log('‚úÖ PWA installed successfully');
              }

              deferredPrompt = null;
              installBtn.style.display = 'none';
            }
          });

          installBtn.addEventListener('mouseenter', () => {
            installBtn.style.transform = 'translateY(-2px)';
            installBtn.style.boxShadow = '0 6px 16px rgba(26, 35, 126, 0.4)';
          });

          installBtn.addEventListener('mouseleave', () => {
            installBtn.style.transform = 'translateY(0)';
            installBtn.style.boxShadow = '0 4px 12px rgba(26, 35, 126, 0.3)';
          });

          document.body.appendChild(installBtn);

          // Hide after 10 seconds if not clicked
          setTimeout(() => {
            if (installBtn.style.display !== 'none') {
              installBtn.style.opacity = '0';
              setTimeout(() => installBtn.remove(), 300);
            }
          }, 10000);
        }
      }

      window.addEventListener('appinstalled', () => {
        console.log('‚úÖ PWA was installed successfully');
        deferredPrompt = null;

        const installBtn = document.getElementById('installButton');
        if (installBtn) {
          installBtn.style.display = 'none';
        }
      });

      // ==================== OFFLINE DETECTION ====================
      window.addEventListener('online', () => {
        console.log('üåê Application is online');
        document.body.classList.remove('offline-mode');

        // Show online toast (if you have toast system)
        if (typeof showToast === 'function') {
          showToast('success', 'Online', 'P≈ôipojen√≠ k internetu obnoveno');
        }
      });

      window.addEventListener('offline', () => {
        console.log('üìµ Application is offline');
        document.body.classList.add('offline-mode');

        // Show offline toast
        if (typeof showToast === 'function') {
          showToast(
            'warning',
            'Offline re≈æim',
            'Pracujete v offline re≈æimu. Data budou synchronizov√°na po obnoven√≠ p≈ôipojen√≠.'
          );
        }
      });

      // ==================== SEARCH PANEL INTEGRATION ====================
      document.addEventListener('DOMContentLoaded', () => {
        const openSearchBtn = document.getElementById('openSearchPanel');
        if (openSearchBtn) {
          openSearchBtn.addEventListener('click', () => {
            if (typeof toggleSearchPanel === 'function') {
              toggleSearchPanel();
            }
          });
        }
      });
    </script>

    <!-- üöÄ ULTRA-OPTIMIZED LOADING: Critical modules only, rest load on-demand -->
    <script src="error-handler.js" defer></script>
    <script>
      // Load non-critical modules progressively after page load
      window.addEventListener('load', () => {
        const modules = [
          'library-loader.js',
          'accessibility.js',
          'notification-system.js',
          'command-stack.js',
          'data-validation.js',
          'calculations-engine.js',
          'app.js',
        ];

        // Load modules one by one with delay to prevent CPU overload
        let index = 0;
        function loadNextModule() {
          if (index >= modules.length) return;

          const script = document.createElement('script');
          script.src = modules[index];
          script.async = true;

          script.onload = () => {
            console.log(`‚úÖ Loaded: ${modules[index]}`);
            index++;
            // Wait 200ms before loading next module (prevents CPU spike)
            setTimeout(loadNextModule, 200);
          };

          script.onerror = () => {
            console.error(`‚ùå Failed: ${modules[index]}`);
            index++;
            setTimeout(loadNextModule, 200);
          };

          document.body.appendChild(script);
        }

        // Start loading after 500ms delay (let page render first)
        setTimeout(loadNextModule, 500);
      });
    </script>

    <!-- ‚úÖ Fast loading - Heavy libraries load on-demand only -->
  </body>
</html>
