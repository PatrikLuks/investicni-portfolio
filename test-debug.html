<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç DEBUG TEST - Portfolio Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
        }
        
        h1 {
            font-size: 2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffd700;
            animation: pulse 1s infinite;
        }
        
        .status.success { background: #00ff00; animation: none; }
        .status.error { background: #ff0000; animation: blink 0.5s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .section {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .section h2 {
            font-size: 1.3em;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
        }
        
        .test-item {
            padding: 10px;
            margin: 10px 0;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-item .icon {
            font-size: 1.5em;
            min-width: 30px;
            text-align: center;
        }
        
        .test-item .name {
            flex: 1;
            font-weight: 600;
        }
        
        .test-item .result {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .log-console {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 400px;
            overflow-y: auto;
            color: #00ff00;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .log-entry.error { color: #ff4444; }
        .log-entry.warning { color: #ffaa00; }
        .log-entry.success { color: #00ff00; }
        .log-entry.info { color: #00aaff; }
        
        .timestamp {
            color: #888;
            margin-right: 10px;
        }
        
        button {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        
        .file-check {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }
        
        .file-item {
            background: rgba(0,0,0,0.2);
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>
            <span class="status" id="main-status"></span>
            üîç Debug Diagnostika
        </h1>
        <p style="margin-bottom: 20px; opacity: 0.9;">
            Kontrola v≈°ech komponent a modul≈Ø Portfolio Manageru
        </p>
        
        <!-- Browser Info -->
        <div class="section">
            <h2>üåê Informace o prohl√≠≈æeƒçi</h2>
            <div id="browser-info"></div>
        </div>
        
        <!-- File Checks -->
        <div class="section">
            <h2>üìÅ Kontrola soubor≈Ø</h2>
            <div class="file-check" id="file-checks"></div>
        </div>
        
        <!-- Module Loader Test -->
        <div class="section">
            <h2>üöÄ Module Loader Test</h2>
            <div id="loader-test"></div>
            <button onclick="testModuleLoader()" style="margin-top: 15px;">
                ‚ñ∂Ô∏è Spustit test naƒç√≠t√°n√≠
            </button>
        </div>
        
        <!-- Console Log -->
        <div class="section">
            <h2>üìä Console Log (real-time)</h2>
            <div class="log-console" id="console-log"></div>
        </div>
    </div>

    <script>
        // ============================================
        // DEBUG UTILITIES
        // ============================================
        
        const debugLog = [];
        const consoleDiv = document.getElementById('console-log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = { timestamp, message, type };
            debugLog.push(entry);
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `<span class="timestamp">${timestamp}</span>${message}`;
            consoleDiv.appendChild(logEntry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            
            // Also log to real console
            const consoleMethod = type === 'error' ? 'error' : type === 'warning' ? 'warn' : 'log';
            console[consoleMethod](`[${timestamp}] ${message}`);
        }
        
        // Intercept console methods
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };
        
        console.log = function(...args) {
            log(args.join(' '), 'info');
            originalConsole.log.apply(console, args);
        };
        
        console.error = function(...args) {
            log(args.join(' '), 'error');
            originalConsole.error.apply(console, args);
        };
        
        console.warn = function(...args) {
            log(args.join(' '), 'warning');
            originalConsole.warn.apply(console, args);
        };
        
        // Catch global errors
        window.addEventListener('error', (e) => {
            log(`‚ùå ERROR: ${e.message} (${e.filename}:${e.lineno})`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            log(`‚ùå UNHANDLED PROMISE: ${e.reason}`, 'error');
        });
        
        // ============================================
        // BROWSER INFO
        // ============================================
        
        function displayBrowserInfo() {
            const info = document.getElementById('browser-info');
            const data = [
                { name: 'User Agent', value: navigator.userAgent },
                { name: 'Browser', value: getBrowserName() },
                { name: 'Platform', value: navigator.platform },
                { name: 'CPU Cores', value: navigator.hardwareConcurrency || 'Unknown' },
                { name: 'Device Memory', value: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Unknown' },
                { name: 'Connection', value: navigator.connection ? navigator.connection.effectiveType : 'Unknown' },
                { name: 'Online', value: navigator.onLine ? '‚úÖ Online' : '‚ùå Offline' }
            ];
            
            info.innerHTML = data.map(item => `
                <div class="test-item">
                    <span class="name">${item.name}:</span>
                    <span class="result">${item.value}</span>
                </div>
            `).join('');
            
            log(`Browser: ${getBrowserName()}`, 'info');
            log(`CPU Cores: ${navigator.hardwareConcurrency || 'Unknown'}`, 'info');
            log(`Device Memory: ${navigator.deviceMemory || 'Unknown'} GB`, 'info');
        }
        
        function getBrowserName() {
            const ua = navigator.userAgent;
            if (/Safari/i.test(ua) && !/Chrome/i.test(ua)) return 'üçé Safari';
            if (/Chrome/i.test(ua)) return 'üåê Chrome';
            if (/Firefox/i.test(ua)) return 'ü¶ä Firefox';
            if (/Edge/i.test(ua)) return 'üåä Edge';
            return 'Unknown';
        }
        
        // ============================================
        // FILE CHECKS
        // ============================================
        
        const criticalFiles = [
            'module-loader.js',
            'module-loader.css',
            'error-handler.js',
            'accessibility.js',
            'notification-system.js',
            'command-stack.js',
            'data-validation.js',
            'calculations-engine.js',
            'app.js',
            'service-worker-v3.js'
        ];
        
        async function checkFiles() {
            const fileChecksDiv = document.getElementById('file-checks');
            log('üîç Kontroluji soubory...', 'info');
            
            for (const file of criticalFiles) {
                const exists = await fileExists(file);
                const icon = exists ? '‚úÖ' : '‚ùå';
                const status = exists ? 'success' : 'error';
                
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `<span>${icon}</span><span>${file}</span>`;
                fileChecksDiv.appendChild(item);
                
                log(`${icon} ${file}`, status);
            }
        }
        
        async function fileExists(filename) {
            try {
                const response = await fetch(filename, { method: 'HEAD' });
                return response.ok;
            } catch (e) {
                return false;
            }
        }
        
        // ============================================
        // MODULE LOADER TEST
        // ============================================
        
        async function testModuleLoader() {
            const testDiv = document.getElementById('loader-test');
            testDiv.innerHTML = '<div class="test-item"><span class="icon">‚è≥</span><span>Spou≈°t√≠m test...</span></div>';
            
            log('üöÄ Starting module loader test...', 'info');
            
            try {
                // Load module-loader.js
                log('Loading module-loader.js...', 'info');
                await loadScript('module-loader.js');
                
                log('‚úÖ module-loader.js loaded', 'success');
                
                // Check if ModuleLoader class exists
                if (typeof ModuleLoader === 'undefined') {
                    throw new Error('ModuleLoader class not found!');
                }
                
                log('‚úÖ ModuleLoader class found', 'success');
                
                // Create instance
                const loader = new ModuleLoader();
                log('‚úÖ ModuleLoader instance created', 'success');
                
                // Check methods
                const methods = ['loadModule', 'loadModules', 'loadApplicationModules', 'showLoadingScreen'];
                methods.forEach(method => {
                    if (typeof loader[method] === 'function') {
                        log(`‚úÖ Method ${method} exists`, 'success');
                    } else {
                        log(`‚ùå Method ${method} MISSING`, 'error');
                    }
                });
                
                // Check properties
                log(`Safari detected: ${loader.isSafari}`, 'info');
                log(`Low power mode: ${loader.isLowPower}`, 'info');
                log(`Max parallel: ${loader.maxParallel}`, 'info');
                
                // Try to load a critical module
                log('Attempting to load error-handler.js...', 'info');
                await loader.loadModule('error-handler.js', true);
                log('‚úÖ error-handler.js loaded successfully', 'success');
                
                testDiv.innerHTML = `
                    <div class="test-item">
                        <span class="icon">‚úÖ</span>
                        <span class="name">Module Loader Test</span>
                        <span class="result">PASSED</span>
                    </div>
                `;
                
                document.getElementById('main-status').className = 'status success';
                log('üéâ All tests PASSED!', 'success');
                
            } catch (error) {
                log(`‚ùå Test FAILED: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
                
                testDiv.innerHTML = `
                    <div class="test-item">
                        <span class="icon">‚ùå</span>
                        <span class="name">Module Loader Test</span>
                        <span class="result">FAILED: ${error.message}</span>
                    </div>
                `;
                
                document.getElementById('main-status').className = 'status error';
            }
        }
        
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        log('üîç Debug page loaded', 'info');
        log('Starting diagnostics...', 'info');
        
        displayBrowserInfo();
        checkFiles();
    </script>
</body>
</html>
